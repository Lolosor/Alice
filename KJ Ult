local animationId = 12447707844
local immediateAnimationId = 16746843881
local delayedAnimationId = 13801083337
local delayedAnimationSpeed = 0.65
local delayTime = 7.5 -- Delay in seconds before playing the delayed animation
local stopDelay = 8 -- Delay in seconds before stopping all animations
local delayedAnimationSkipTime = 1.7 -- Time in seconds to skip to

local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local humRp = character:WaitForChild("HumanoidRootPart")

-- Create and play sound effects
local function playSounds()
    local soundSFX = Instance.new("Sound")
    soundSFX.SoundId = "rbxassetid://17150550302"
    soundSFX.Volume = 2
    soundSFX.Name = "SFX"
    soundSFX.Parent = humRp
    soundSFX:Play()

    local soundSFX2 = Instance.new("Sound")
    soundSFX2.SoundId = "rbxassetid://17150550559"
    soundSFX2.Volume = 2
    soundSFX2.Name = "SFX2"
    soundSFX2.Parent = humRp
    soundSFX2:Play()
end

local function createEffects()
    -- Create and configure the fine effect
    local actuallyNice = game.ReplicatedStorage.Resources.KJEffects["fine...1"]:Clone()
    actuallyNice.CFrame = humRp.CFrame
    actuallyNice.CanCollide = false

    local weld = Instance.new("Weld")
    weld.Parent = actuallyNice
    weld.Part0 = actuallyNice
    weld.Part1 = humRp
    weld.C1 = CFrame.new(0, 0, 0)

    -- Create and configure the emit effects
    local boom = game.ReplicatedStorage.Resources.KJEffects["fine...Emit"]:Clone()
    boom.Parent = workspace
    boom.CanCollide = false
    boom.CFrame = humRp.CFrame * CFrame.new(0, -0.65, 0)

    local boom2 = game.ReplicatedStorage.Resources.KJEffects["fine...Emit2"]:Clone()
    boom2.Parent = workspace
    boom2.CanCollide = false
    boom2.CFrame = humRp.CFrame * CFrame.new(0, -0.65, 0)

    local weld2 = Instance.new("Weld")
    weld2.Parent = boom
    weld2.Part0 = boom
    weld2.Part1 = humRp
    weld2.C1 = CFrame.new(0, -0.65, 0)

    -- Emit particles from the first effect
    delay(0.16, function()
        for _, Particles in pairs(boom:GetDescendants()) do
            if Particles:IsA("ParticleEmitter") then
                actuallyNice.Parent = workspace
                Particles:Emit(Particles:GetAttribute("EmitCount"))
            end
        end
    end)

    -- Cleanup after 8.17 seconds
    delay(8.17, function()
        for _, Particles in pairs(boom2:GetDescendants()) do
            if Particles:IsA("ParticleEmitter") then
                Particles:Emit(Particles:GetAttribute("EmitCount"))
            end
        end

        wait(0.4)
        actuallyNice:Destroy()
        boom2:Destroy()
        boom:Destroy()
    end)
end

local function dela(seconds, callback)
    task.wait(seconds)
    callback()
end

local function onAnimationPlayed(animationTrack)
    if animationTrack.Animation.AnimationId == "rbxassetid://" .. animationId then
        -- Stop all currently playing animations
        for _, animTrack in pairs(humanoid:GetPlayingAnimationTracks()) do
            animTrack:Stop()
        end

        -- Play the immediate animation with speed adjustment
        local immediateAnim = Instance.new("Animation")
        immediateAnim.AnimationId = "rbxassetid://" .. immediateAnimationId
        local immediateAnimTrack = humanoid:LoadAnimation(immediateAnim)
        immediateAnimTrack:Play()
        immediateAnimTrack:AdjustSpeed(delayedAnimationSpeed) -- Set speed to 0.6

        -- Play sound effects and create visual effects
        playSounds()
        createEffects()

        -- Wait for 6 seconds before playing the delayed animation
        dela(delayTime, function()
            local delayedAnim = Instance.new("Animation")
            delayedAnim.AnimationId = "rbxassetid://" .. delayedAnimationId
            local delayedAnimTrack = humanoid:LoadAnimation(delayedAnim)
            delayedAnimTrack:Play()

            -- Wait for 0.8 seconds before skipping to 1.7 seconds
            dela(0.8, function()
                delayedAnimTrack:Stop() -- Stop the animation to reset its position
                delayedAnimTrack:Play() -- Restart the animation
                delayedAnimTrack.TimePosition = delayedAnimationSkipTime -- Skip to 1.7 seconds
            end)
        end)

        -- Wait for 8 seconds before stopping all animations
        dela(stopDelay, function()
            for _, animTrack in pairs(humanoid:GetPlayingAnimationTracks()) do
                animTrack:Stop()
            end
        end)
    end
end

humanoid.AnimationPlayed:Connect(onAnimationPlayed)
